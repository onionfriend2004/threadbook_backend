// Password ‚Äî value object –¥–ª—è –ø–∞—Ä–æ–ª—è.
// –•—Ä–∞–Ω–∏—Ç —Ö—ç—à –ø–∞—Ä–æ–ª—è –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –µ–≥–æ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å.
//
// üí° –ü–æ—á–µ–º—É —Ö—ç—à, –∞ –Ω–µ plaintext?
// - –í –¥–æ–º–µ–Ω–µ –º—ã –ù–ò–ö–û–ì–î–ê –Ω–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å plaintext-–ø–∞—Ä–æ–ª–µ–º!
// - Plaintext –ø–∞—Ä–æ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¢–û–õ–¨–ö–û –≤ delivery-—Å–ª–æ–µ (HTTP-—Ö–µ–Ω–¥–ª–µ—Ä)
// - –í –¥–æ–º–µ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç —É–∂–µ —Ö—ç—à (–∏–ª–∏ plaintext –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)

package domain

import (
	"strings"
)

// Password ‚Äî value object –¥–ª—è —Ö—ç—à–∞ –ø–∞—Ä–æ–ª—è.
type Password string

// NewPasswordFromPlaintext —Å–æ–∑–¥–∞—ë—Ç Password –∏–∑ plaintext-–ø–∞—Ä–æ–ª—è.
// –í—ã–ø–æ–ª–Ω—è–µ—Ç –±–∞–∑–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî bcrypt —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ service).
func NewPasswordFromPlaintext(plaintext string) (Password, error) {
	if plaintext == "" {
		return "", ErrWeakPassword("password is required")
	}
	if len(plaintext) < 8 {
		return "", ErrWeakPassword("password must be at least 8 characters")
	}
	// ‚ö†Ô∏è –í–ê–ñ–ù–û: –∑–¥–µ—Å—å –ù–ï —Ö—ç—à–∏—Ä—É–µ–º! –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∑–∞–¥–∞—á–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (service/adapter)
	// –ù–æ –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ plaintext –≤–∞–ª–∏–¥–µ–Ω.
	return Password(plaintext), nil
}

// HashedPassword —Å–æ–∑–¥–∞—ë—Ç Password –∏–∑ —É–∂–µ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ –ë–î.
func HashedPassword(hashed string) Password {
	// –•—ç—à —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–Ω—ã–º (–æ–Ω —É–∂–µ –ø—Ä–æ—à—ë–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)
	return Password(hashed)
}

// String –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ö—ç—à (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: –Ω–µ –ª–æ–≥–∏—Ä—É–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!)
func (p Password) String() string {
	return string(p)
}

// IsHashed –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–∞—Ä–æ–ª—å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.
// –ü—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞: —Ö—ç—à bcrypt –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "$2a$", "$2b$", "$2y$"
func (p Password) IsHashed() bool {
	return strings.HasPrefix(string(p), "$2")
}

// =============================================================================
// üí° –ü–†–ò–ù–¶–ò–ü:
// - Domain –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ bcrypt, –Ω–æ –∑–Ω–∞–µ—Ç: "–ø–∞—Ä–æ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å plaintext –∏–ª–∏ —Ö—ç—à"
// - –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∑–∞–¥–∞—á–∞ service (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º crypto/bcrypt)
// =============================================================================
